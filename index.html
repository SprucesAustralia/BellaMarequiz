<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bella Mare Cleaners’ Guide & Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
      color: #333;
    }
    h1, h2 {
      color: #2b547e;
    }
    section {
      background: #fff;
      padding: 15px 20px;
      margin-bottom: 20px;
      border-radius: 4px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .question {
      margin-top: 10px;
      padding: 10px;
      background: #f0f8ff;
      border-left: 4px solid #2b547e;
      border-radius: 4px;
    }
    .question label {
      margin-right: 15px;
    }
    #submitBtn {
      background: #2b547e;
      color: #fff;
      border: none;
      padding: 10px 20px;
      font-size: 1rem;
      border-radius: 4px;
      cursor: not-allowed; /* default to disabled look */
      opacity: 0.6;
    }
    #submitBtn.enabled {
      cursor: pointer;
      opacity: 1;
    }
    .footer-note {
      font-size: 0.9rem;
      color: #666;
      margin-top: 30px;
    }
    #nameField {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Bella Mare Beachside Apartments</h1>
  <h2>Cleaners’ Key Points & Quiz</h2>

  <!-- Name Field -->
  <div id="nameField">
    <label for="participantName"><strong>Enter your name:</strong></label>
    <input type="text" id="participantName" name="participantName" placeholder="e.g., John Doe" oninput="checkNameFilled()">
  </div>

  <form id="quizForm">
    <!-- SECTION 1 -->
    <section>
      <h3>1. Property Layout & Access</h3>
      <p>- There are no lifts on-site; access to upper floors is via stairwells only.<br>
         - Cleaners must be prepared to carry supplies up/down the stairs.</p>
      <div class="question">
        <p><strong>Question 1 (True/False):</strong> Bella Mare has elevators for easy access to upper floors.</p>
        <label>
          <input type="radio" name="q1" value="true" onclick="checkAnswers()"> True
        </label>
        <label>
          <input type="radio" name="q1" value="false" onclick="checkAnswers()"> False
        </label>
      </div>
    </section>

    <!-- SECTION 2 -->
    <section>
      <h3>2. Daily Cleaning Responsibilities (Common Areas)</h3>
      <p>- Keep stairwells, hallways, and the BBQ/pool area clean and free of debris.<br>
         - Never block exits or stairwells with cleaning equipment.</p>
      <div class="question">
        <p><strong>Question 2 (True/False):</strong> It is acceptable to block the stairwells with cleaning supplies if you're working quickly.</p>
        <label>
          <input type="radio" name="q2" value="true" onclick="checkAnswers()"> True
        </label>
        <label>
          <input type="radio" name="q2" value="false" onclick="checkAnswers()"> False
        </label>
      </div>
    </section>

    <!-- SECTION 3 -->
    <section>
      <h3>3. Apartment Housekeeping</h3>
      <p>- Report any maintenance issues (broken items, leaks) to management.<br>
         - Always lock up and secure the unit after cleaning.</p>
      <div class="question">
        <p><strong>Question 3 (True/False):</strong> If you find a broken fixture in an apartment, you should let management know.</p>
        <label>
          <input type="radio" name="q3" value="true" onclick="checkAnswers()"> True
        </label>
        <label>
          <input type="radio" name="q3" value="false" onclick="checkAnswers()"> False
        </label>
      </div>
    </section>

    <!-- SECTION 4 -->
    <section>
      <h3>4. Waste Management & Recycling</h3>
      <p>- Dispose of trash and recyclables in their designated bins.<br>
         - Keep bin areas tidy and avoid mixing regular garbage with recyclables.</p>
      <div class="question">
        <p><strong>Question 4 (True/False):</strong> It’s important to place trash and recyclables in separate, labeled bins.</p>
        <label>
          <input type="radio" name="q4" value="true" onclick="checkAnswers()"> True
        </label>
        <label>
          <input type="radio" name="q4" value="false" onclick="checkAnswers()"> False
        </label>
      </div>
    </section>

    <!-- SECTION 5 -->
    <section>
      <h3>5. Pool & Spa Maintenance (Cleaner’s Role)</h3>
      <p>- Clear debris from around the pool/spa area daily.<br>
         - Alert management if pool water looks cloudy or chemicals seem off; do not add chemicals yourself.</p>
      <div class="question">
        <p><strong>Question 5 (True/False):</strong> Cleaners should personally add pool chemicals if the water looks cloudy.</p>
        <label>
          <input type="radio" name="q5" value="true" onclick="checkAnswers()"> True
        </label>
        <label>
          <input type="radio" name="q5" value="false" onclick="checkAnswers()"> False
        </label>
      </div>
    </section>

    <!-- SECTION 6 -->
    <section>
      <h3>6. Basic Emergency & Safety Notes</h3>
      <p>- In a fire or other emergency, use stairwells for evacuation.<br>
         - Never wedge open fire doors; keep corridors clear for safe exit.</p>
      <div class="question">
        <p><strong>Question 6 (True/False):</strong> It’s okay to keep fire doors propped open for convenience as long as someone is nearby.</p>
        <label>
          <input type="radio" name="q6" value="true" onclick="checkAnswers()"> True
        </label>
        <label>
          <input type="radio" name="q6" value="false" onclick="checkAnswers()"> False
        </label>
      </div>
    </section>

    <!-- SECTION 7 -->
    <section>
      <h3>7. Occasional Tasks & Helpful Tips</h3>
      <p>- During peak seasons, be prepared for more frequent cleans.<br>
         - Stay alert to any unusual damage or suspicious activity and inform management promptly.</p>
      <div class="question">
        <p><strong>Question 7 (True/False):</strong> In busy periods, cleaners should anticipate extra work and maintain frequent checks on common areas.</p>
        <label>
          <input type="radio" name="q7" value="true" onclick="checkAnswers()"> True
        </label>
        <label>
          <input type="radio" name="q7" value="false" onclick="checkAnswers()"> False
        </label>
      </div>
    </section>

    <button type="submit" id="submitBtn" disabled>Submit</button>
  </form>

  <div class="footer-note">
    <p><em>Note:</em> You can only press <strong>Submit</strong> after all answers are correct!<br>
    Once you submit, your answers and name will be sent to Supabase.</p>
  </div>

  <!-- Include the supabase-js client (v2) from a CDN or local package. Example: -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // Replace with your actual Supabase details
    const supabaseUrl = "https://czzbegsfbnuhpsnsehvy.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN6emJlZ3NmYm51aHBzbnNlaHZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk3NjExMzIsImV4cCI6MjA1NTMzNzEzMn0.1nvoKeX0mJgdY2indHp4iZmmf0z1pBCD2jAP8NxHy3k";
    const supabase = createClient(supabaseUrl, supabaseKey);

    // Correct answers key
    const correctAnswers = {
      q1: "false",  // Bella Mare has no lifts => correct is "False"
      q2: "false",  // It's acceptable to block stairwells? => "False"
      q3: "true",   // Report broken fixture => "True"
      q4: "true",   // Separate trash/recyclables => "True"
      q5: "false",  // Cleaners add pool chemicals => "False"
      q6: "false",  // Prop open fire doors is OK => "False"
      q7: "true"    // Expect more frequent cleans in busy periods => "True"
    };

    const quizForm = document.getElementById('quizForm');
    const submitBtn = document.getElementById('submitBtn');
    const participantNameInput = document.getElementById('participantName');

    // This will track each question’s selected answer
    let userAnswers = {};

    // Check if participant name is filled
    function checkNameFilled() {
      // If name is blank, we disable the submit button. If name is present, we proceed to check answers as usual.
      const nameValue = participantNameInput.value.trim();
      if (!nameValue) {
        submitBtn.disabled = true;
        submitBtn.classList.remove('enabled');
      } else {
        // If name is filled, re-check answers to see if we can enable the button
        checkAnswers();
      }
    }

    // Check if all answers are correct
    function checkAnswers() {
      // Collect all radio inputs from the form
      const formElements = document.querySelectorAll('#quizForm input[type="radio"]');
      userAnswers = {};  // Reset answers each time

      formElements.forEach((radio) => {
        if (radio.checked) {
          userAnswers[radio.name] = radio.value;
        }
      });

      let allCorrect = true;
      for (let key in correctAnswers) {
        if (!userAnswers[key] || userAnswers[key] !== correctAnswers[key]) {
          allCorrect = false;
          break;
        }
      }

      // Check participant name as well
      const nameValue = participantNameInput.value.trim();
      if (!nameValue) {
        allCorrect = false;
      }

      if (allCorrect) {
        submitBtn.disabled = false;
        submitBtn.classList.add('enabled');
      } else {
        submitBtn.disabled = true;
        submitBtn.classList.remove('enabled');
      }
    }

    // Submit event handler
    quizForm.addEventListener('submit', async (event) => {
      event.preventDefault();

      const nameValue = participantNameInput.value.trim();
      if (!nameValue) {
        alert("Please enter your name before submitting.");
        return;
      }

      // We already know answers are correct if the button is enabled, but let's confirm:
      let allCorrect = true;
      for (let q in correctAnswers) {
        if (!userAnswers[q] || userAnswers[q] !== correctAnswers[q]) {
          allCorrect = false;
          break;
        }
      }

      if (!allCorrect) {
        alert("Some answers are incorrect or missing. Please verify.");
        return;
      }

      // At this point, all answers are correct. We'll submit data to Supabase.
      // Prepare the row to insert
      const rowToInsert = {
        participant: nameValue,
        q1: userAnswers.q1,
        q2: userAnswers.q2,
        q3: userAnswers.q3,
        q4: userAnswers.q4,
        q5: userAnswers.q5,
        q6: userAnswers.q6,
        q7: userAnswers.q7
      };

      // Insert into "cleaners_quiz_responses" table
      let { data, error } = await supabase
        .from('cleaners_quiz_responses')
        .insert([rowToInsert]);

      if (error) {
        console.error("Supabase insert error:", error);
        alert("There was an error saving your quiz response. Please try again or contact admin.");
      } else {
        alert("Your quiz responses have been successfully submitted!");
        // Optionally, you could redirect, or clear the form, etc.
        // For example, to disable the form after submission:
        quizForm.reset();
        submitBtn.disabled = true;
        submitBtn.classList.remove('enabled');
      }
    });

    // Expose the checkAnswers and checkNameFilled to the window, 
    // so the HTML elements' oninput/onclick can call them
    window.checkAnswers = checkAnswers;
    window.checkNameFilled = checkNameFilled;
  </script>
</body>
</html>
